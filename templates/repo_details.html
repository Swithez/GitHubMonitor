<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ repo_info.full_name }} - –ê–Ω–∞–ª–∏–∑</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .card { box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); transition: transform 0.2s; }
        .card:hover { transform: scale(1.02); }
        .btn-primary { background-color: #007bff; border: none; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-outline-secondary { transition: background-color 0.3s, color 0.3s; }
        .btn-outline-secondary:hover { background-color: #6c757d; color: white; }
        #loadingText { font-size: 1.2em; color: #007bff; animation: pulse 1s infinite; margin-top: 15px; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .results-row strong { color: #343a40; }
    </style>
</head>
<body>
    <div class="container py-4">
        <div class="mb-3">
            <a href="/" class="btn btn-outline-secondary btn-sm">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ–∏—Å–∫—É</a>
            <a href="/history" class="btn btn-outline-secondary btn-sm">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤</a>
        </div>
        
        <h2 class="mb-4">üíª –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: {{ repo_info.full_name }}</h2>

        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                <p class="card-text"><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ repo_info.description or "–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è." }}</p>
                <p class="card-text"><strong>–Ø–∑—ã–∫:</strong> {{ repo_info.language or "–°–º–µ—à–∞–Ω–Ω—ã–π/–ù–µ —É–∫–∞–∑–∞–Ω" }}</p>
                <p class="card-text"><strong>–ó–≤–µ–∑–¥—ã:</strong> <span class="badge bg-warning text-dark">{{ repo_info.stargazers_count }}</span></p>
                <p class="card-text"><strong>–ü–æ–¥–ø–∏—Å—á–∏–∫–∏:</strong> <span class="badge bg-info">{{ repo_info.subscribers_count }}</span></p>
            </div>
        </div>

        <hr>
        
        <h3>–ê–Ω–∞–ª–∏–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥</h3>
        
        <form action="/get_stats" method="POST" id="statsForm">
            <input type="hidden" name="owner" value="{{ owner }}">
            <input type="hidden" name="repo_name" value="{{ repo_name }}">
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="start_date" class="form-label">–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞:</label>
                    <input type="date" id="start_date" name="start_date" value="{{ start_date if stats else '' }}" class="form-control" required>
                </div>
                <div class="col-md-6">
                    <label for="end_date" class="form-label">–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞:</label>
                    <input type="date" id="end_date" name="end_date" value="{{ end_date if stats else '' }}" class="form-control" required>
                </div>
            </div>
            
            <div class="btn-group mb-3 d-flex flex-wrap" role="group">
                <button type="button" class="btn btn-outline-secondary" onclick="getData(30)">–ó–∞ –º–µ—Å—è—Ü</button>
                <button type="button" class="btn btn-outline-secondary" onclick="getData(90)">–ó–∞ –∫–≤–∞—Ä—Ç–∞–ª</button>
                <button type="button" class="btn btn-outline-secondary" onclick="getData(180)">–ó–∞ –ø–æ–ª—É–≥–æ–¥–∏–µ</button>
                <button type="button" class="btn btn-outline-secondary" onclick="getData(365)">–ó–∞ –≥–æ–¥</button>
            </div>
            <div class="d-grid">
                <button type="submit" id="submitBtn" class="btn btn-primary">–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ø–µ—Ä–∏–æ–¥</button>
            </div>
        </form>
        
        <div id="loadingText" style="display: none;">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>

        {% if stats %}
        <div class="card results-row">
            <div class="card-body">
                <h5 class="card-title text-success">‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ ({{ stats.analysis_period_days }} –¥–Ω–µ–π)</h5>
                
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–º–∏—Ç–æ–≤:</strong> <span class="text-primary">{{ stats.totalCommits }}</span></p>
                        <p><strong>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–≤—Å–µ–≥–æ):</strong> <span class="text-primary">{{ stats.totalContributors }}</span></p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>–°—Ä–µ–¥–Ω–µ–µ –∫–æ–º–º–∏—Ç–æ–≤ –≤ –¥–µ–Ω—å:</strong> <span class="text-primary">{{ stats.avgCommitsPerDay }}</span></p>
                        <p><strong>–ò–Ω–¥–µ–∫—Å –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</strong> <span class="text-primary">{{ stats.activityIndex }}%</span></p>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <script>
        document.getElementById('loadingText').style.display = 'none';

        function formatDate(date) {
            const yyyy = date.getFullYear();
            const mm = String(date.getMonth() + 1).padStart(2, '0');
            const dd = String(date.getDate()).padStart(2, '0');
            return `${yyyy}-${mm}-${dd}`;
        }

        function getData(days) {
            document.getElementById('loadingText').style.display = 'block';

            const today = new Date();
            const start = new Date();
            start.setDate(today.getDate() - days);

            document.getElementById('end_date').value = formatDate(today);
            document.getElementById('start_date').value = formatDate(start);
            
            setTimeout(() => {
                document.getElementById('statsForm').submit();
            }, 10); 
        }
        
        document.getElementById('statsForm').onsubmit = function() {
            document.getElementById('loadingText').style.display = 'block';
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>